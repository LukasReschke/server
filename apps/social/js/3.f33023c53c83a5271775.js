(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{533:function(n,e,i){"use strict";var o=i(128),a=i.n(o),r=i(400),s=i.n(r),c=i(535),l=i.n(c),p=i(536),u=i(538),d=i.n(u),A=i(57),h=i(0),m={bind:function(t){h.default.nextTick((function(){t.focus()}))}},g=i(3),v=i.n(g),f=i(1),C={name:"ActorAvatar",components:{Avatar:a.a},props:{actor:{type:Object,default:function(){}},size:{type:Number,default:32}},data:function(){return{followingText:t("social","Following")}},computed:{avatarUrl:function(){return Object(f.generateUrl)("/apps/social/api/v1/global/actor/avatar?id="+this.item.attributedTo)}}},b=i(42),y=Object(b.a)(C,(function(){var t=this.$createElement,n=this._self._c||t;return this.actor.local?n("avatar",{attrs:{size:this.size,user:this.actor.preferredUsername,"display-name":this.actor.account,"disable-tooltip":!0}}):n("avatar",{attrs:{size:this.size,url:this.avatarUrl,"disable-tooltip":!0}})}),[],!1,null,null,null).exports;function x(t,n,e,i,o,a,r){try{var s=t[a](r),c=s.value}catch(t){return void e(t)}s.done?n(c):Promise.resolve(c).then(i,o)}function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var w,T,j={name:"Composer",components:{PopoverMenu:s.a,Avatar:a.a,ActorAvatar:y,EmojiPicker:l.a,VueTribute:p.a},directives:{FocusOnCreate:m},mixins:[A.a],props:{},data:function(){var t=this;return{type:localStorage.getItem("social.lastPostType")||"followers",loading:!1,post:"",miniatures:[],postAttachments:[],canType:!0,search:"",replyTo:null,tributeOptions:{spaceSelectsMatch:!0,collection:[{trigger:"@",lookup:function(t){return t.key+t.value},menuItemTemplate:function(t){return'<img src="'+t.original.avatar+'" /><div><span class="displayName">'+t.original.key+'</span><span class="account">'+t.original.value+"</span></div>"},selectTemplate:function(t){return'<span class="mention" contenteditable="false"><a href="'+t.original.url+'" target="_blank"><img src="'+t.original.avatar+'" />@'+t.original.value+"</a></span>"},values:function(n,e){var i=[];n.length<1&&e(i),t.remoteSearchAccounts(n).then((function(t){for(var n in t.data.result.accounts){var o=t.data.result.accounts[n];i.push({key:o.preferredUsername,value:o.account,url:o.url,avatar:o.local?Object(f.generateUrl)("/avatar/".concat(o.preferredUsername,"/32")):Object(f.generateUrl)("apps/social/api/v1/global/actor/avatar?id=".concat(o.id))})}e(i)}))}},{trigger:"#",menuItemTemplate:function(t){return t.original.value},selectTemplate:function(t){var n="";return n=void 0===t?this.currentMentionTextSnapshot:t.original.value,'<span class="hashtag" contenteditable="false"><a href="'+Object(f.generateUrl)("/timeline/tags/"+n)+'" target="_blank">#'+n+"</a></span>"},values:function(n,e){var i=[];n.length<1&&e(i),t.remoteSearchHashtags(n).then((function(t){for(var n in t.data.result.exact&&i.push({key:t.data.result.exact,value:t.data.result.exact}),t.data.result.tags){var o=t.data.result.tags[n];i.push({key:o.hashtag,value:o.hashtag})}e(i)}))}}],noMatchTemplate:function(){if("#"===this.current.collection.trigger)return""===this.current.mentionText?void 0:'<li data-index="0">#'+this.current.mentionText+"</li>"}},menuOpened:!1}},computed:{currentVisibilityIconClass:function(){return this.visibilityIconClass(this.type)},visibilityIconClass:function(){var t=this;return function(n){switch(void 0===n&&(n=t.type),n){case"public":return"icon-link";case"followers":return"icon-contacts-dark";case"direct":return"icon-external";case"unlisted":return"icon-password"}}},currentVisibilityPostLabel:function(){return this.visibilityPostLabel(this.type)},visibilityPostLabel:function(){var n=this;return function(e){switch(void 0===e&&(e=n.type),e){case"public":return t("social","Post publicly");case"followers":return t("social","Post to followers");case"direct":return t("social","Post to recipients");case"unlisted":return t("social","Post unlisted")}}},activeState:function(){var t=this;return function(n){return n===t.type}},visibilityPopover:function(){var n=this;return[{action:function(){n.switchType("public")},icon:this.visibilityIconClass("public"),active:this.activeState("public"),text:t("social","Public"),longtext:t("social","Post to public timelines")},{action:function(){n.switchType("unlisted")},icon:this.visibilityIconClass("unlisted"),active:this.activeState("unlisted"),text:t("social","Unlisted"),longtext:t("social","Do not post to public timelines")},{action:function(){n.switchType("followers")},icon:this.visibilityIconClass("followers"),active:this.activeState("followers"),text:t("social","Followers"),longtext:t("social","Post to followers only")},{action:function(){n.switchType("direct")},icon:this.visibilityIconClass("direct"),active:this.activeState("direct"),text:t("social","Direct"),longtext:t("social","Post to mentioned users only")}]}},mounted:function(){var t=this;this.$root.$on("composer-reply",(function(n){t.replyTo=n,t.type="direct"}))},methods:{AddAttachment:function(){var t=this,n=this.$refs.addAttach.files[0],e=new FileReader;e.onload=function(e){var i=document.createElement("canvas"),o=i.getContext("2d"),a=new Image;a.onload=function(){var a=this.width,r=this.height;r=Math.floor(r*(265/a)),a=265,r>180&&(a=Math.floor(a*(180/r)),r=180),i.width=a,i.height=r,o.drawImage(this,0,0,a,r),o.beginPath(),o.fillStyle="black",o.lineWidth=1,o.moveTo(0,0),o.lineTo(a,0),o.lineTo(a,r),o.lineTo(0,r),o.lineTo(0,0),o.stroke(),o.beginPath(),o.arc(a-20,20,10,0,2*Math.PI),o.fillStyle="white",o.fill(),o.lineWidth=2,o.StrokeStyle="darkgray",o.stroke(),o.beginPath(),o.moveTo(a-25,15),o.lineTo(a-15,25),o.stroke(),o.moveTo(a-15,15),o.lineTo(a-25,25),o.stroke(),e.target.result.startsWith("data:image")||(o.fillStyle="black",o.font="12px Arial",o.fillText(n.name,30,r-20)),t.miniatures.push({img:i.toDataURL(),coords:String(a-20)+",20,10"})},t.postAttachments.push(e.target.result),e.target.result.startsWith("data:image")?a.src=e.target.result:a.src=Object(f.generateUrl)("svg/core/filetypes/x-office-document?color=d8d8d8")},e.readAsDataURL(n)},removeAttachment:function(t){this.postAttachments.splice(t,1),this.miniatures.splice(t,1)},getImageMapCoords:function(t){return this.miniatures[t].coords},insert:function(t){if("object"===k(t)){var n=t[Object.keys(t)[0]];t=n[Object.keys(n)[0]]}this.post+=this.$twemoji.parse(t)+" ",this.$refs.composerInput.innerHTML+=this.$twemoji.parse(t)+" ",this.$refs.emojiPicker.hide()},togglePopoverMenu:function(){this.menuOpened=!this.menuOpened},hidePopoverMenu:function(){this.menuOpened=!1},switchType:function(t){this.type=t,this.menuOpened=!1,localStorage.setItem("social.lastPostType",t)},getPostData:function(){var t=this.$refs.composerInput.cloneNode(!0);Array.from(t.getElementsByClassName("emoji")).forEach((function(t){var n=document.createTextNode(t.getAttribute("alt"));t.replaceWith(n)}));var n=t.innerHTML,e=[],i=/<span class="mention"[^>]+><a[^>]+><img[^>]+>@([\w-_.]+@[\w-.]+)/g,o=null;do{(o=i.exec(n))&&e.push(o[1])}while(o);null!==this.replyTo&&e.push(this.replyTo.actor_info.account);var a=/>#([^<]+)</g,r=[];o=null;do{(o=a.exec(n))&&r.push(o[1])}while(o);var s=n.replace(/<(?!\/div)[^>]+>/gi,"").replace(/<\/div>/gi,"\n").trim(),c={content:s=d.a.decode(s),to:e,hashtags:r,type:this.type,attachments:this.postAttachments};return this.replyTo&&(c.replyTo=this.replyTo.id),c},keyup:function(t){(t.shiftKey||t.ctrlKey)&&this.createPost(t)},updatePostFromTribute:function(t){this.$refs.composerInput.oninput(t)},createPost:(w=regeneratorRuntime.mark((function t(n){var e,i,o,a,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.getPostData(),i=/@([-\w]+)$/,!(o=e.content.match(i))){t.next=8;break}return t.next=6,this.remoteSearchAccounts(o[1]);case 6:1===(a=t.sent).data.result.accounts.length&&(e.content=e.content.replace(i,"@"+a.data.result.accounts[0].account),e.to.push(a.data.result.accounts[0].account));case 8:this.loading=!0,this.$store.dispatch("post",e).then((function(t){r.loading=!1,r.replyTo=null,r.post="",r.$refs.composerInput.innerText=r.post,r.postAttachments=[],r.miniatures=[],r.$store.dispatch("refreshTimeline")}));case 10:case"end":return t.stop()}}),t,this)})),T=function(){var t=this,n=arguments;return new Promise((function(e,i){var o=w.apply(t,n);function a(t){x(o,e,i,a,r,"next",t)}function r(t){x(o,e,i,a,r,"throw",t)}a(void 0)}))},function(t){return T.apply(this,arguments)}),closeReply:function(){this.replyTo=null,this.$store.commit("setComposerDisplayStatus",!1)},remoteSearchAccounts:function(t){return v.a.get(Object(f.generateUrl)("apps/social/api/v1/global/accounts/search?search="+t))},remoteSearchHashtags:function(t){return v.a.get(Object(f.generateUrl)("apps/social/api/v1/global/tags/search?search="+t))}}},B=i(35),P=i.n(B),S=i(539),W={insert:"head",singleton:!1},I=(P()(S.a,W),S.a.locals,i(542)),_={insert:"head",singleton:!1},U=(P()(I.a,_),I.a.locals,Object(b.a)(j,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"new-post",attrs:{"data-id":""}},[e("div",{staticClass:"new-post-author"},[e("avatar",{attrs:{user:t.currentUser.uid,"display-name":t.currentUser.displayName,"disable-tooltip":!0,size:32}}),t._v(" "),e("div",{staticClass:"post-author"},[e("span",{staticClass:"post-author-name"},[t._v("\n\t\t\t\t"+t._s(t.currentUser.displayName)+"\n\t\t\t")]),t._v(" "),e("span",{staticClass:"post-author-id"},[t._v("\n\t\t\t\t"+t._s(t.socialId)+"\n\t\t\t")])])],1),t._v(" "),t.replyTo?e("div",{staticClass:"reply-to"},[e("p",[e("span",[t._v("In reply to")]),t._v(" "),e("actor-avatar",{attrs:{actor:t.replyTo.actor_info,size:16}}),t._v(" "),e("strong",[t._v(t._s(t.replyTo.actor_info.account))]),t._v(" "),e("a",{staticClass:"icon-close",on:{click:function(n){return t.closeReply()}}})],1),t._v(" "),e("div",{staticClass:"reply-to-preview"},[t._v("\n\t\t\t"+t._s(t.replyTo.content)+"\n\t\t")])]):t._e(),t._v(" "),e("form",{staticClass:"new-post-form",on:{submit:function(n){return n.preventDefault(),t.createPost(n)}}},[e("vue-tribute",{attrs:{options:t.tributeOptions}},[e("div",{directives:[{name:"contenteditable",rawName:"v-contenteditable:post.dangerousHTML",value:t.canType&&!t.loading,expression:"canType && !loading",arg:"post",modifiers:{dangerousHTML:!0}}],ref:"composerInput",staticClass:"message",class:{"icon-loading":t.loading},attrs:{placeholder:"What would you like to share?"},on:{keyup:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"enter",13,n.key,"Enter")?null:(n.preventDefault(),t.keyup(n))},"tribute-replaced":t.updatePostFromTribute}})]),t._v(" "),e("emoji-picker",{ref:"emojiPicker",staticClass:"emoji-picker-wrapper",attrs:{search:t.search},on:{emoji:t.insert},scopedSlots:t._u([{key:"emoji-invoker",fn:function(n){var i=n.events;return e("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Insert emoji",expression:"'Insert emoji'"}],staticClass:"emoji-invoker",attrs:{tabindex:"0"},on:{keyup:[function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"enter",13,n.key,"Enter")?null:i.click(n)},function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"space",32,n.key,[" ","Spacebar"])?null:i.click(n)}],click:function(t){return t.stopPropagation(),i.click(t)}}})}},{key:"emoji-picker",fn:function(n){var i=n.emojis,o=n.insert;return e("div",{staticClass:"emoji-picker popovermenu"},[e("div",[e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"},{name:"focus-on-create",rawName:"v-focus-on-create"}],attrs:{type:"text"},domProps:{value:t.search},on:{keyup:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"enter",13,n.key,"Enter")?null:o(i)},input:function(n){n.target.composing||(t.search=n.target.value)}}})]),t._v(" "),e("div",t._l(i,(function(n,i){return e("div",{key:i},[e("h5",[t._v(t._s(i))]),t._v(" "),e("div",t._l(n,(function(n,i){return e("span",{key:i,staticClass:"emoji",attrs:{title:i,tabindex:"0"},domProps:{innerHTML:t._s(t.$twemoji.parse(n))},on:{click:function(t){return o(n)},keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:o(n)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"space",32,e.key,[" ","Spacebar"])?null:o(n)}]}})})),0)])})),0)])])}}])}),t._v(" "),e("masonry",t._l(t.miniatures,(function(n,i){return e("div",{key:i,ref:"miniatures",refInFor:!0},[e("img",{attrs:{src:n.img,usemap:"#map"+i}}),t._v(" "),e("map",{attrs:{name:"map"+i}},[e("area",{attrs:{shape:"circle",coords:t.getImageMapCoords(i)},on:{click:function(n){return t.removeAttachment(i)}}})])])})),0),t._v(" "),e("div",{staticClass:"options"},[e("input",{staticClass:"submit primary",attrs:{disabled:t.post.length<1||"<br>"===t.post,type:"submit",title:"","data-original-title":"Post"},domProps:{value:t.currentVisibilityPostLabel}}),t._v(" "),e("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.hidePopoverMenu,expression:"hidePopoverMenu"}]},[e("button",{class:t.currentVisibilityIconClass,on:{click:function(n){return n.preventDefault(),t.togglePopoverMenu(n)}}}),t._v(" "),e("div",{staticClass:"popovermenu menu-center",class:{open:t.menuOpened}},[e("popover-menu",{attrs:{menu:t.visibilityPopover}})],1)]),t._v(" "),e("div",{staticClass:"emptySpace"}),t._v(" "),e("label",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Attach document",expression:"'Attach document'"}],staticClass:"button icon-upload",attrs:{for:"file-upload"}}),t._v(" "),e("input",{ref:"addAttach",staticClass:"upload-button",attrs:{id:"file-upload",type:"file"},on:{change:t.AddAttachment}})])],1)])}),[],!1,null,"0cfa7d2b",null));e.a=U.exports},539:function(t,n,e){"use strict";var i=e(36),o=e.n(i),a=e(37),r=e.n(a),s=e(540),c=e.n(s),l=e(541),p=r()(o.a),u=c()(l.a);p.push([t.i,".new-post[data-v-0cfa7d2b]{padding:10px;background-color:var(--color-main-background);position:sticky;top:47px;z-index:100;margin-bottom:10px}.new-post-author[data-v-0cfa7d2b]{padding:5px;display:flex;flex-wrap:wrap}.new-post-author .post-author[data-v-0cfa7d2b]{padding:6px}.new-post-author .post-author .post-author-name[data-v-0cfa7d2b]{font-weight:bold}.new-post-author .post-author .post-author-id[data-v-0cfa7d2b]{opacity:.7}.reply-to[data-v-0cfa7d2b]{background-image:url("+u+");background-position:5px 5px;background-repeat:no-repeat;margin-left:39px;margin-bottom:20px;overflow:hidden;background-color:#fafafa;border-radius:3px;padding:5px;padding-left:30px}.reply-to .icon-close[data-v-0cfa7d2b]{display:inline-block;float:right;opacity:.7;padding:3px}.new-post-form[data-v-0cfa7d2b]{flex-grow:1;position:relative;top:-10px;margin-left:39px}.message[data-v-0cfa7d2b]{width:100%;padding-right:44px;min-height:70px;min-width:2px;display:block}[contenteditable=true][data-v-0cfa7d2b]:empty:before{content:attr(placeholder);display:block;opacity:.5}input[type=submit].inline[data-v-0cfa7d2b]{width:44px;height:44px;margin:0;padding:13px;background-color:transparent;border:none;opacity:0.3;position:absolute;bottom:0;right:0}.options[data-v-0cfa7d2b]{display:flex;align-items:flex-end;width:100%;flex-direction:row-reverse}.options>div[data-v-0cfa7d2b]{position:relative}.options button[data-v-0cfa7d2b]{width:34px;height:34px}.emptySpace[data-v-0cfa7d2b]{flex-grow:1}.icon-upload[data-v-0cfa7d2b]{width:34px;height:34px}.upload-button[data-v-0cfa7d2b]{display:none}.emoji-invoker[data-v-0cfa7d2b]{background-image:var(--icon-social-emoji-000);background-position:center center;background-repeat:no-repeat;width:38px;opacity:0.5;background-size:16px 16px;height:38px;cursor:pointer;display:block}.emoji-invoker[data-v-0cfa7d2b]:focus,.emoji-invoker[data-v-0cfa7d2b]:hover{opacity:1}.emoji-picker-wrapper[data-v-0cfa7d2b]{position:absolute;right:0;top:0}.emoji-picker.popovermenu[data-v-0cfa7d2b]{display:block;padding:5px;width:200px;height:200px;top:44px}.emoji-picker>div[data-v-0cfa7d2b]{overflow:hidden;overflow-y:scroll;height:190px}.emoji-picker input[data-v-0cfa7d2b]{width:100%}.emoji-picker span.emoji[data-v-0cfa7d2b]{padding:3px}.emoji-picker span.emoji[data-v-0cfa7d2b]:focus{background-color:var(--color-background-dark)}.emoji-picker .emoji img[data-v-0cfa7d2b]{width:16px}.popovermenu[data-v-0cfa7d2b]{top:55px}.attachment-picker-wrapper[data-v-0cfa7d2b]{position:absolute;right:0;top:2}\n","",{version:3,sources:["webpack://src/components/Composer.vue"],names:[],mappings:"AA8GA,2BACC,YAAa,CACb,6CAA8C,CAC9C,eAAgB,CAChB,QAAS,CACT,WAAY,CACZ,kBAAmB,CACnB,kCAGA,WAAY,CACZ,YAAa,CACb,cAAe,CAHhB,+CAME,WAAY,CANd,iEASG,gBAAiB,CATpB,+DAaG,UAAW,CACX,2BAKF,wDAA0C,CAC1C,2BAA4B,CAC5B,2BAA4B,CAC5B,gBAAiB,CACjB,kBAAmB,CACnB,eAAgB,CAChB,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,iBAAkB,CAVnB,uCAaE,oBAAqB,CACrB,WAAY,CACZ,UAAW,CACX,WAAY,CACZ,gCAID,WAAY,CACZ,iBAAkB,CAClB,SAAU,CACV,gBAAiB,CACjB,0BAGA,UAAW,CACX,kBAAmB,CACnB,eAAgB,CAChB,aAAc,CACd,aAAc,CACd,qDAGA,yBAA0B,CAC1B,aAAc,CACd,UAAW,CACX,2CAGA,UAAW,CACX,WAAY,CACZ,QAAS,CACT,YAAa,CACb,4BAA6B,CAC7B,WAAY,CACZ,WAAY,CACZ,iBAAkB,CAClB,QAAS,CACT,OAAQ,CACR,0BAGA,YAAa,CACb,oBAAqB,CACrB,UAAW,CACX,0BAA2B,CAC3B,8BAGA,iBAAkB,CAClB,iCAGA,UAAW,CACX,WAAY,CACZ,6BAGA,WAAW,CACX,8BAGA,UAAW,CACX,WAAY,CACZ,gCAGA,YAAa,CACb,gCAGA,6CAA8C,CAC9C,iCAAkC,CAClC,2BAA4B,CAC5B,UAAW,CACX,WAAY,CACZ,yBAA0B,CAC1B,WAAY,CACZ,cAAe,CACf,aAAc,CACd,4EAIA,SAAU,CACV,uCAGA,iBAAkB,CAClB,OAAQ,CACR,KAAM,CACN,2CAGA,aAAc,CACd,WAAY,CACZ,WAAY,CACZ,YAAa,CACb,QAAS,CACT,mCAGA,eAAgB,CAChB,iBAAkB,CAClB,YAAa,CACb,qCAGA,UAAW,CACX,0CAGA,WAAY,CACZ,gDAGA,6CAA8C,CAC9C,0CAGA,UAAW,CACX,8BAGA,QAAS,CACT,4CAGA,iBAAkB,CAClB,OAAQ,CACR,KAAM",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.new-post {\n\tpadding: 10px;\n\tbackground-color: var(--color-main-background);\n\tposition: sticky;\n\ttop: 47px;\n\tz-index: 100;\n\tmargin-bottom: 10px;\n}\n\n.new-post-author {\n\tpadding: 5px;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\n\t.post-author {\n\t\tpadding: 6px;\n\n\t\t.post-author-name {\n\t\t\tfont-weight: bold;\n\t\t}\n\n\t\t.post-author-id {\n\t\t\topacity: .7;\n\t\t}\n\t}\n}\n\n.reply-to {\n\tbackground-image: url(../../img/reply.svg);\n\tbackground-position: 5px 5px;\n\tbackground-repeat: no-repeat;\n\tmargin-left: 39px;\n\tmargin-bottom: 20px;\n\toverflow: hidden;\n\tbackground-color: #fafafa;\n\tborder-radius: 3px;\n\tpadding: 5px;\n\tpadding-left: 30px;\n\n\t.icon-close {\n\t\tdisplay: inline-block;\n\t\tfloat: right;\n\t\topacity: .7;\n\t\tpadding: 3px;\n\t}\n}\n\n.new-post-form {\n\tflex-grow: 1;\n\tposition: relative;\n\ttop: -10px;\n\tmargin-left: 39px;\n}\n\n.message {\n\twidth: 100%;\n\tpadding-right: 44px;\n\tmin-height: 70px;\n\tmin-width: 2px;\n\tdisplay: block;\n}\n\n[contenteditable=true]:empty:before {\n\tcontent: attr(placeholder);\n\tdisplay: block; /* For Firefox */\n\topacity: .5;\n}\n\ninput[type=submit].inline {\n\twidth: 44px;\n\theight: 44px;\n\tmargin: 0;\n\tpadding: 13px;\n\tbackground-color: transparent;\n\tborder: none;\n\topacity: 0.3;\n\tposition: absolute;\n\tbottom: 0;\n\tright: 0;\n}\n\n.options {\n\tdisplay: flex;\n\talign-items: flex-end;\n\twidth: 100%;\n\tflex-direction: row-reverse;\n}\n\n.options > div {\n\tposition: relative;\n}\n\n.options button {\n\twidth: 34px;\n\theight: 34px;\n}\n\n.emptySpace {\n\tflex-grow:1;\n}\n\n.icon-upload {\n\twidth: 34px;\n\theight: 34px;\n}\n\n.upload-button {\n\tdisplay: none;\n}\n\n.emoji-invoker {\n\tbackground-image: var(--icon-social-emoji-000);\n\tbackground-position: center center;\n\tbackground-repeat: no-repeat;\n\twidth: 38px;\n\topacity: 0.5;\n\tbackground-size: 16px 16px;\n\theight: 38px;\n\tcursor: pointer;\n\tdisplay: block;\n}\n\n.emoji-invoker:focus,\n.emoji-invoker:hover {\n\topacity: 1;\n}\n\n.emoji-picker-wrapper {\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n}\n\n.emoji-picker.popovermenu {\n\tdisplay: block;\n\tpadding: 5px;\n\twidth: 200px;\n\theight: 200px;\n\ttop: 44px;\n}\n\n.emoji-picker > div {\n\toverflow: hidden;\n\toverflow-y: scroll;\n\theight: 190px;\n}\n\n.emoji-picker input {\n\twidth: 100%;\n}\n\n.emoji-picker span.emoji {\n\tpadding: 3px;\n}\n\n.emoji-picker span.emoji:focus {\n\tbackground-color: var(--color-background-dark);\n}\n\n.emoji-picker .emoji img {\n\twidth: 16px;\n}\n\n.popovermenu {\n\ttop: 55px;\n}\n\n.attachment-picker-wrapper {\n\tposition: absolute;\n\tright: 0;\n\ttop: 2;\n}\n"],sourceRoot:""}]),n.a=p},541:function(t,n,e){"use strict";n.a=e.p+"reply.svg?1a8318e0ee406799a42ed1485a1fff59"},542:function(t,n,e){"use strict";var i=e(36),o=e.n(i),a=e(37),r=e.n(a)()(o.a);r.push([t.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* Tribute-specific styles TODO: properly scope component css */\n.tribute-container {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\theight: auto;\n\tmax-height: 300px;\n\tmax-width: 500px;\n\tmin-width: 200px;\n\toverflow: auto;\n\tdisplay: block;\n\tz-index: 999999;\n\tborder-radius: 4px;\n\tbox-shadow: 0 1px 3px var(--color-box-shadow);\n}\n.tribute-container ul {\n\tmargin: 0;\n\tmargin-top: 2px;\n\tpadding: 0;\n\tlist-style: none;\n\tbackground: var(--color-main-background);\n\tborder-radius: 4px;\n\tbackground-clip: padding-box;\n\toverflow: hidden;\n}\n.tribute-container li {\n\tcolor: var(--color-text);\n\tpadding: 5px 10px;\n\tcursor: pointer;\n\tfont-size: 14px;\n\tdisplay: flex;\n}\n.tribute-container li span {\n\tdisplay: block;\n}\n.tribute-container li.highlight,\n.tribute-container li:hover {\n\tbackground: var(--color-primary);\n\tcolor: var(--color-primary-text);\n}\n.tribute-container li img {\n\twidth: 32px;\n\theight: 32px;\n\tborder-radius: 50%;\n\toverflow: hidden;\n\tmargin-right: 10px;\n\tmargin-left: -3px;\n\tmargin-top: 3px;\n}\n.tribute-container li span {\n\tfont-weight: bold;\n}\n.tribute-container li.no-match {\n\tcursor: default;\n}\n.tribute-container .menu-highlighted {\n\tfont-weight: bold;\n}\n.tribute-container .account,\n.tribute-container li.highlight .account,\n.tribute-container li:hover .account {\n\tfont-weight: normal;\n\tcolor: var(--color-text-light);\n\topacity: 0.5;\n}\n.tribute-container li.highlight .account,\n.tribute-container li:hover .account {\n\tcolor: var(--color-primary-text) !important;\n\topacity: .6;\n}\n.message .mention {\n\tcolor: var(--color-primary-element);\n\tbackground-color: var(--color-background-dark);\n\tborder-radius: 5px;\n\tpadding-top: 1px;\n\tpadding-left: 2px;\n\tpadding-bottom: 1px;\n\tpadding-right: 5px;\n}\n.mention img {\n\twidth: 16px;\n\tborder-radius: 50%;\n\toverflow: hidden;\n\tmargin-right: 3px;\n\tvertical-align: middle;\n\tmargin-top: -1px;\n}\n.hashtag {\n\ttext-decoration: underline;\n}\n","",{version:3,sources:["webpack://src/components/Composer.vue"],names:[],mappings:";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4RA,+DAAA;AACA;CACA,kBAAA;CACA,MAAA;CACA,OAAA;CACA,YAAA;CACA,iBAAA;CACA,gBAAA;CACA,gBAAA;CACA,cAAA;CACA,cAAA;CACA,eAAA;CACA,kBAAA;CACA,6CAAA;AACA;AAEA;CACA,SAAA;CACA,eAAA;CACA,UAAA;CACA,gBAAA;CACA,wCAAA;CACA,kBAAA;CACA,4BAAA;CACA,gBAAA;AACA;AAEA;CACA,wBAAA;CACA,iBAAA;CACA,eAAA;CACA,eAAA;CACA,aAAA;AACA;AAEA;CACA,cAAA;AACA;AAEA;;CAEA,gCAAA;CACA,gCAAA;AACA;AAEA;CACA,WAAA;CACA,YAAA;CACA,kBAAA;CACA,gBAAA;CACA,kBAAA;CACA,iBAAA;CACA,eAAA;AACA;AAEA;CACA,iBAAA;AACA;AAEA;CACA,eAAA;AACA;AAEA;CACA,iBAAA;AACA;AAEA;;;CAGA,mBAAA;CACA,8BAAA;CACA,YAAA;AACA;AAEA;;CAEA,2CAAA;CACA,WAAA;AACA;AAEA;CACA,mCAAA;CACA,8CAAA;CACA,kBAAA;CACA,gBAAA;CACA,iBAAA;CACA,mBAAA;CACA,kBAAA;AACA;AAEA;CACA,WAAA;CACA,kBAAA;CACA,gBAAA;CACA,iBAAA;CACA,sBAAA;CACA,gBAAA;AACA;AAEA;CACA,0BAAA;AACA",sourcesContent:["\x3c!--\n  - @copyright Copyright (c) 2018 Julius Härtl <jus@bitgrid.net>\n  -\n  - @author Julius Härtl <jus@bitgrid.net>\n  -\n  - @license GNU AGPL version 3 or any later version\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program. If not, see <http://www.gnu.org/licenses/>.\n  -\n  --\x3e\n\n<template>\n\t<div class=\"new-post\" data-id=\"\">\n\t\t<div class=\"new-post-author\">\n\t\t\t<avatar :user=\"currentUser.uid\" :display-name=\"currentUser.displayName\" :disable-tooltip=\"true\"\n\t\t\t\t:size=\"32\" />\n\t\t\t<div class=\"post-author\">\n\t\t\t\t<span class=\"post-author-name\">\n\t\t\t\t\t{{ currentUser.displayName }}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"post-author-id\">\n\t\t\t\t\t{{ socialId }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"replyTo\" class=\"reply-to\">\n\t\t\t<p>\n\t\t\t\t<span>In reply to</span>\n\t\t\t\t<actor-avatar :actor=\"replyTo.actor_info\" :size=\"16\" />\n\t\t\t\t<strong>{{ replyTo.actor_info.account }}</strong>\n\t\t\t\t<a class=\"icon-close\" @click=\"closeReply()\" />\n\t\t\t</p>\n\t\t\t<div class=\"reply-to-preview\">\n\t\t\t\t{{ replyTo.content }}\n\t\t\t</div>\n\t\t</div>\n\t\t<form class=\"new-post-form\" @submit.prevent=\"createPost\">\n\t\t\t<vue-tribute :options=\"tributeOptions\">\n\t\t\t\t\x3c!-- eslint-disable-next-line vue/valid-v-model --\x3e\n\t\t\t\t<div ref=\"composerInput\" v-contenteditable:post.dangerousHTML=\"canType && !loading\" class=\"message\"\n\t\t\t\t\tplaceholder=\"What would you like to share?\" :class=\"{'icon-loading': loading}\" @keyup.prevent.enter=\"keyup\"\n\t\t\t\t\t@tribute-replaced=\"updatePostFromTribute\" />\n\t\t\t</vue-tribute>\n\t\t\t<emoji-picker ref=\"emojiPicker\" :search=\"search\" class=\"emoji-picker-wrapper\"\n\t\t\t\t@emoji=\"insert\">\n\t\t\t\t<div slot=\"emoji-invoker\" v-tooltip=\"'Insert emoji'\" slot-scope=\"{ events }\"\n\t\t\t\t\tclass=\"emoji-invoker\" tabindex=\"0\" @keyup.enter=\"events.click\"\n\t\t\t\t\t@keyup.space=\"events.click\" @click.stop=\"events.click\" />\n\t\t\t\t\x3c!-- eslint-disable-next-line vue/no-template-shadow --\x3e\n\t\t\t\t<div slot=\"emoji-picker\" slot-scope=\"{ emojis, insert }\" class=\"emoji-picker popovermenu\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<input v-model=\"search\" v-focus-on-create type=\"text\"\n\t\t\t\t\t\t\t\t@keyup.enter=\"insert(emojis)\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div v-for=\"(emojiGroup, category) in emojis\" :key=\"category\">\n\t\t\t\t\t\t\t\t<h5>{{ category }}</h5>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\x3c!-- eslint-disable vue/no-v-html --\x3e\n\t\t\t\t\t\t\t\t\t<span v-for=\"(emoji, emojiName) in emojiGroup\" :key=\"emojiName\" :title=\"emojiName\"\n\t\t\t\t\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\t\t\t\t\tclass=\"emoji\" @click=\"insert(emoji)\" @keyup.enter=\"insert(emoji)\"\n\t\t\t\t\t\t\t\t\t\t@keyup.space=\"insert(emoji)\" v-html=\"$twemoji.parse(emoji)\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</emoji-picker>\n\n\t\t\t<masonry>\n\t\t\t\t<div v-for=\"(item, index) in miniatures\" :key=\"index\" ref=\"miniatures\">\n\t\t\t\t\t<img :src=\"item.img\" :usemap=\"'#map' + index\">\n\t\t\t\t\t<map :name=\"'map' + index\">\n\t\t\t\t\t\t<area shape=\"circle\" :coords=\"getImageMapCoords(index)\" @click=\"removeAttachment(index)\">\n\t\t\t\t\t</map>\n\t\t\t\t</div>\n\t\t\t</masonry>\n\n\t\t\t<div class=\"options\">\n\t\t\t\t<input :value=\"currentVisibilityPostLabel\" :disabled=\"post.length < 1 || post==='<br>'\" class=\"submit primary\"\n\t\t\t\t\ttype=\"submit\" title=\"\" data-original-title=\"Post\">\n\t\t\t\t<div v-click-outside=\"hidePopoverMenu\">\n\t\t\t\t\t<button :class=\"currentVisibilityIconClass\" @click.prevent=\"togglePopoverMenu\" />\n\t\t\t\t\t<div :class=\"{open: menuOpened}\" class=\"popovermenu menu-center\">\n\t\t\t\t\t\t<popover-menu :menu=\"visibilityPopover\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"emptySpace\" />\n\t\t\t\t<label v-tooltip=\"'Attach document'\" class=\"button icon-upload\" for=\"file-upload\" />\n\t\t\t\t<input id=\"file-upload\" ref=\"addAttach\" class=\"upload-button\"\n\t\t\t\t\ttype=\"file\" @change=\"AddAttachment\">\n\t\t\t</div>\n\t\t</form>\n\t</div>\n</template>\n<style scoped lang=\"scss\">\n\n\t.new-post {\n\t\tpadding: 10px;\n\t\tbackground-color: var(--color-main-background);\n\t\tposition: sticky;\n\t\ttop: 47px;\n\t\tz-index: 100;\n\t\tmargin-bottom: 10px;\n\t}\n\n\t.new-post-author {\n\t\tpadding: 5px;\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\n\t\t.post-author {\n\t\t\tpadding: 6px;\n\n\t\t\t.post-author-name {\n\t\t\t\tfont-weight: bold;\n\t\t\t}\n\n\t\t\t.post-author-id {\n\t\t\t\topacity: .7;\n\t\t\t}\n\t\t}\n\t}\n\n\t.reply-to {\n\t\tbackground-image: url(../../img/reply.svg);\n\t\tbackground-position: 5px 5px;\n\t\tbackground-repeat: no-repeat;\n\t\tmargin-left: 39px;\n\t\tmargin-bottom: 20px;\n\t\toverflow: hidden;\n\t\tbackground-color: #fafafa;\n\t\tborder-radius: 3px;\n\t\tpadding: 5px;\n\t\tpadding-left: 30px;\n\n\t\t.icon-close {\n\t\t\tdisplay: inline-block;\n\t\t\tfloat: right;\n\t\t\topacity: .7;\n\t\t\tpadding: 3px;\n\t\t}\n\t}\n\n\t.new-post-form {\n\t\tflex-grow: 1;\n\t\tposition: relative;\n\t\ttop: -10px;\n\t\tmargin-left: 39px;\n\t}\n\n\t.message {\n\t\twidth: 100%;\n\t\tpadding-right: 44px;\n\t\tmin-height: 70px;\n\t\tmin-width: 2px;\n\t\tdisplay: block;\n\t}\n\n\t[contenteditable=true]:empty:before {\n\t\tcontent: attr(placeholder);\n\t\tdisplay: block; /* For Firefox */\n\t\topacity: .5;\n\t}\n\n\tinput[type=submit].inline {\n\t\twidth: 44px;\n\t\theight: 44px;\n\t\tmargin: 0;\n\t\tpadding: 13px;\n\t\tbackground-color: transparent;\n\t\tborder: none;\n\t\topacity: 0.3;\n\t\tposition: absolute;\n\t\tbottom: 0;\n\t\tright: 0;\n\t}\n\n\t.options {\n\t\tdisplay: flex;\n\t\talign-items: flex-end;\n\t\twidth: 100%;\n\t\tflex-direction: row-reverse;\n\t}\n\n\t.options > div {\n\t\tposition: relative;\n\t}\n\n\t.options button {\n\t\twidth: 34px;\n\t\theight: 34px;\n\t}\n\n\t.emptySpace {\n\t\tflex-grow:1;\n\t}\n\n\t.icon-upload {\n\t\twidth: 34px;\n\t\theight: 34px;\n\t}\n\n\t.upload-button {\n\t\tdisplay: none;\n\t}\n\n\t.emoji-invoker {\n\t\tbackground-image: var(--icon-social-emoji-000);\n\t\tbackground-position: center center;\n\t\tbackground-repeat: no-repeat;\n\t\twidth: 38px;\n\t\topacity: 0.5;\n\t\tbackground-size: 16px 16px;\n\t\theight: 38px;\n\t\tcursor: pointer;\n\t\tdisplay: block;\n\t}\n\n\t.emoji-invoker:focus,\n\t.emoji-invoker:hover {\n\t\topacity: 1;\n\t}\n\n\t.emoji-picker-wrapper {\n\t\tposition: absolute;\n\t\tright: 0;\n\t\ttop: 0;\n\t}\n\n\t.emoji-picker.popovermenu {\n\t\tdisplay: block;\n\t\tpadding: 5px;\n\t\twidth: 200px;\n\t\theight: 200px;\n\t\ttop: 44px;\n\t}\n\n\t.emoji-picker > div {\n\t\toverflow: hidden;\n\t\toverflow-y: scroll;\n\t\theight: 190px;\n\t}\n\n\t.emoji-picker input {\n\t\twidth: 100%;\n\t}\n\n\t.emoji-picker span.emoji {\n\t\tpadding: 3px;\n\t}\n\n\t.emoji-picker span.emoji:focus {\n\t\tbackground-color: var(--color-background-dark);\n\t}\n\n\t.emoji-picker .emoji img {\n\t\twidth: 16px;\n\t}\n\n\t.popovermenu {\n\t\ttop: 55px;\n\t}\n\n\t.attachment-picker-wrapper {\n\t\tposition: absolute;\n\t\tright: 0;\n\t\ttop: 2;\n\t}\n</style>\n<style>\n\t/* Tribute-specific styles TODO: properly scope component css */\n\t.tribute-container {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\theight: auto;\n\t\tmax-height: 300px;\n\t\tmax-width: 500px;\n\t\tmin-width: 200px;\n\t\toverflow: auto;\n\t\tdisplay: block;\n\t\tz-index: 999999;\n\t\tborder-radius: 4px;\n\t\tbox-shadow: 0 1px 3px var(--color-box-shadow);\n\t}\n\n\t.tribute-container ul {\n\t\tmargin: 0;\n\t\tmargin-top: 2px;\n\t\tpadding: 0;\n\t\tlist-style: none;\n\t\tbackground: var(--color-main-background);\n\t\tborder-radius: 4px;\n\t\tbackground-clip: padding-box;\n\t\toverflow: hidden;\n\t}\n\n\t.tribute-container li {\n\t\tcolor: var(--color-text);\n\t\tpadding: 5px 10px;\n\t\tcursor: pointer;\n\t\tfont-size: 14px;\n\t\tdisplay: flex;\n\t}\n\n\t.tribute-container li span {\n\t\tdisplay: block;\n\t}\n\n\t.tribute-container li.highlight,\n\t.tribute-container li:hover {\n\t\tbackground: var(--color-primary);\n\t\tcolor: var(--color-primary-text);\n\t}\n\n\t.tribute-container li img {\n\t\twidth: 32px;\n\t\theight: 32px;\n\t\tborder-radius: 50%;\n\t\toverflow: hidden;\n\t\tmargin-right: 10px;\n\t\tmargin-left: -3px;\n\t\tmargin-top: 3px;\n\t}\n\n\t.tribute-container li span {\n\t\tfont-weight: bold;\n\t}\n\n\t.tribute-container li.no-match {\n\t\tcursor: default;\n\t}\n\n\t.tribute-container .menu-highlighted {\n\t\tfont-weight: bold;\n\t}\n\n\t.tribute-container .account,\n\t.tribute-container li.highlight .account,\n\t.tribute-container li:hover .account {\n\t\tfont-weight: normal;\n\t\tcolor: var(--color-text-light);\n\t\topacity: 0.5;\n\t}\n\n\t.tribute-container li.highlight .account,\n\t.tribute-container li:hover .account {\n\t\tcolor: var(--color-primary-text) !important;\n\t\topacity: .6;\n\t}\n\n\t.message .mention {\n\t\tcolor: var(--color-primary-element);\n\t\tbackground-color: var(--color-background-dark);\n\t\tborder-radius: 5px;\n\t\tpadding-top: 1px;\n\t\tpadding-left: 2px;\n\t\tpadding-bottom: 1px;\n\t\tpadding-right: 5px;\n\t}\n\n\t.mention img {\n\t\twidth: 16px;\n\t\tborder-radius: 50%;\n\t\toverflow: hidden;\n\t\tmargin-right: 3px;\n\t\tvertical-align: middle;\n\t\tmargin-top: -1px;\n\t}\n\n\t.hashtag {\n\t\ttext-decoration: underline;\n\t}\n</style>\n<script>\n\nimport Avatar from '@nextcloud/vue/dist/Components/Avatar'\nimport PopoverMenu from '@nextcloud/vue/dist/Components/PopoverMenu'\nimport EmojiPicker from 'vue-emoji-picker'\nimport VueTribute from 'vue-tribute'\nimport he from 'he'\nimport CurrentUserMixin from './../mixins/currentUserMixin'\nimport FocusOnCreate from '../directives/focusOnCreate'\nimport axios from '@nextcloud/axios'\nimport ActorAvatar from './ActorAvatar.vue'\nimport { generateUrl } from '@nextcloud/router'\n\nexport default {\n\tname: 'Composer',\n\tcomponents: {\n\t\tPopoverMenu,\n\t\tAvatar,\n\t\tActorAvatar,\n\t\tEmojiPicker,\n\t\tVueTribute\n\t},\n\tdirectives: {\n\t\tFocusOnCreate: FocusOnCreate\n\t},\n\tmixins: [CurrentUserMixin],\n\tprops: {},\n\tdata() {\n\t\treturn {\n\t\t\ttype: localStorage.getItem('social.lastPostType') || 'followers',\n\t\t\tloading: false,\n\t\t\tpost: '',\n\t\t\tminiatures: [],\t\t// miniatures of images stored in postAttachments\n\t\t\tpostAttachments: [],\t// The toot's attachments\n\t\t\tcanType: true,\n\t\t\tsearch: '',\n\t\t\treplyTo: null,\n\t\t\ttributeOptions: {\n\t\t\t\tspaceSelectsMatch: true,\n\t\t\t\tcollection: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttrigger: '@',\n\t\t\t\t\t\tlookup: function(item) {\n\t\t\t\t\t\t\treturn item.key + item.value\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmenuItemTemplate: function(item) {\n\t\t\t\t\t\t\treturn '<img src=\"' + item.original.avatar + '\" /><div>'\n\t\t\t\t\t\t\t\t+ '<span class=\"displayName\">' + item.original.key + '</span>'\n\t\t\t\t\t\t\t\t+ '<span class=\"account\">' + item.original.value + '</span>'\n\t\t\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tselectTemplate: function(item) {\n\t\t\t\t\t\t\treturn '<span class=\"mention\" contenteditable=\"false\">'\n\t\t\t\t\t\t\t\t+ '<a href=\"' + item.original.url + '\" target=\"_blank\"><img src=\"' + item.original.avatar + '\" />@' + item.original.value + '</a></span>'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tvalues: (text, cb) => {\n\t\t\t\t\t\t\tlet users = []\n\n\t\t\t\t\t\t\tif (text.length < 1) {\n\t\t\t\t\t\t\t\tcb(users)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.remoteSearchAccounts(text).then((result) => {\n\t\t\t\t\t\t\t\tfor (var i in result.data.result.accounts) {\n\t\t\t\t\t\t\t\t\tlet user = result.data.result.accounts[i]\n\t\t\t\t\t\t\t\t\tusers.push({\n\t\t\t\t\t\t\t\t\t\tkey: user.preferredUsername,\n\t\t\t\t\t\t\t\t\t\tvalue: user.account,\n\t\t\t\t\t\t\t\t\t\turl: user.url,\n\t\t\t\t\t\t\t\t\t\tavatar: user.local ? generateUrl(`/avatar/${user.preferredUsername}/32`) : generateUrl(`apps/social/api/v1/global/actor/avatar?id=${user.id}`)\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcb(users)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttrigger: '#',\n\t\t\t\t\t\tmenuItemTemplate: function(item) {\n\t\t\t\t\t\t\treturn item.original.value\n\t\t\t\t\t\t},\n\t\t\t\t\t\tselectTemplate: function(item) {\n\t\t\t\t\t\t\tlet tag = ''\n\t\t\t\t\t\t\t// item is undefined if selectTemplate is called from a noMatchTemplate menu\n\t\t\t\t\t\t\tif (typeof item === 'undefined') {\n\t\t\t\t\t\t\t\ttag = this.currentMentionTextSnapshot\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttag = item.original.value\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn '<span class=\"hashtag\" contenteditable=\"false\">'\n\t\t\t\t\t\t\t\t+ '<a href=\"' + generateUrl('/timeline/tags/' + tag) + '\" target=\"_blank\">#' + tag + '</a></span>'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tvalues: (text, cb) => {\n\t\t\t\t\t\t\tlet tags = []\n\n\t\t\t\t\t\t\tif (text.length < 1) {\n\t\t\t\t\t\t\t\tcb(tags)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.remoteSearchHashtags(text).then((result) => {\n\t\t\t\t\t\t\t\tif (result.data.result.exact) {\n\t\t\t\t\t\t\t\t\ttags.push({\n\t\t\t\t\t\t\t\t\t\tkey: result.data.result.exact,\n\t\t\t\t\t\t\t\t\t\tvalue: result.data.result.exact\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfor (var i in result.data.result.tags) {\n\t\t\t\t\t\t\t\t\tlet tag = result.data.result.tags[i]\n\t\t\t\t\t\t\t\t\ttags.push({\n\t\t\t\t\t\t\t\t\t\tkey: tag.hashtag,\n\t\t\t\t\t\t\t\t\t\tvalue: tag.hashtag\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcb(tags)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tnoMatchTemplate() {\n\t\t\t\t\tif (this.current.collection.trigger === '#') {\n\t\t\t\t\t\tif (this.current.mentionText === '') {\n\t\t\t\t\t\t\treturn undefined\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn '<li data-index=\"0\">#' + this.current.mentionText + '</li>'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tmenuOpened: false\n\n\t\t}\n\t},\n\tcomputed: {\n\t\tcurrentVisibilityIconClass() {\n\t\t\treturn this.visibilityIconClass(this.type)\n\t\t},\n\t\tvisibilityIconClass() {\n\t\t\treturn (type) => {\n\t\t\t\tif (typeof type === 'undefined') {\n\t\t\t\t\ttype = this.type\n\t\t\t\t}\n\t\t\t\tswitch (type) {\n\t\t\t\tcase 'public':\n\t\t\t\t\treturn 'icon-link'\n\t\t\t\tcase 'followers':\n\t\t\t\t\treturn 'icon-contacts-dark'\n\t\t\t\tcase 'direct':\n\t\t\t\t\treturn 'icon-external'\n\t\t\t\tcase 'unlisted':\n\t\t\t\t\treturn 'icon-password'\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcurrentVisibilityPostLabel() {\n\t\t\treturn this.visibilityPostLabel(this.type)\n\t\t},\n\t\tvisibilityPostLabel() {\n\t\t\treturn (type) => {\n\t\t\t\tif (typeof type === 'undefined') {\n\t\t\t\t\ttype = this.type\n\t\t\t\t}\n\t\t\t\tswitch (type) {\n\t\t\t\tcase 'public':\n\t\t\t\t\treturn t('social', 'Post publicly')\n\t\t\t\tcase 'followers':\n\t\t\t\t\treturn t('social', 'Post to followers')\n\t\t\t\tcase 'direct':\n\t\t\t\t\treturn t('social', 'Post to recipients')\n\t\t\t\tcase 'unlisted':\n\t\t\t\t\treturn t('social', 'Post unlisted')\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tactiveState() {\n\t\t\treturn (type) => {\n\t\t\t\tif (type === this.type) {\n\t\t\t\t\treturn true\n\t\t\t\t} else {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tvisibilityPopover() {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tthis.switchType('public')\n\t\t\t\t\t},\n\t\t\t\t\ticon: this.visibilityIconClass('public'),\n\t\t\t\t\tactive: this.activeState('public'),\n\t\t\t\t\ttext: t('social', 'Public'),\n\t\t\t\t\tlongtext: t('social', 'Post to public timelines')\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tthis.switchType('unlisted')\n\t\t\t\t\t},\n\t\t\t\t\ticon: this.visibilityIconClass('unlisted'),\n\t\t\t\t\tactive: this.activeState('unlisted'),\n\t\t\t\t\ttext: t('social', 'Unlisted'),\n\t\t\t\t\tlongtext: t('social', 'Do not post to public timelines')\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tthis.switchType('followers')\n\t\t\t\t\t},\n\t\t\t\t\ticon: this.visibilityIconClass('followers'),\n\t\t\t\t\tactive: this.activeState('followers'),\n\t\t\t\t\ttext: t('social', 'Followers'),\n\t\t\t\t\tlongtext: t('social', 'Post to followers only')\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tthis.switchType('direct')\n\t\t\t\t\t},\n\t\t\t\t\ticon: this.visibilityIconClass('direct'),\n\t\t\t\t\tactive: this.activeState('direct'),\n\t\t\t\t\ttext: t('social', 'Direct'),\n\t\t\t\t\tlongtext: t('social', 'Post to mentioned users only')\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.$root.$on('composer-reply', (data) => {\n\t\t\tthis.replyTo = data\n\t\t\tthis.type = 'direct'\n\t\t})\n\t},\n\tmethods: {\n\t\tAddAttachment() {\n\t\t\t// TODO: handle (or prevent) mulitple files\n\t\t\tlet self = this\n\t\t\tlet file = this.$refs.addAttach.files[0]\n\t\t\tlet reader = new FileReader()\n\n\t\t\t// Called when selected file is completly loaded to draw a miniature\n\t\t\treader.onload = function(e) {\n\t\t\t\tlet canvas = document.createElement('canvas')\n\t\t\t\tlet ctx = canvas.getContext('2d')\n\t\t\t\tlet width = 265\n\t\t\t\tlet height = 180\n\t\t\t\tlet img = new Image()\n\n\t\t\t\t// Called when img.src is set below\n\t\t\t\timg.onload = function() {\n\n\t\t\t\t\t// scale image for miniature\n\t\t\t\t\tlet imgWidth = this.width\n\t\t\t\t\tlet imgHeight = this.height\n\t\t\t\t\timgHeight = Math.floor(imgHeight * (width / imgWidth))\n\t\t\t\t\timgWidth = width\n\t\t\t\t\tif (imgHeight > height) {\n\t\t\t\t\t\timgWidth = Math.floor(imgWidth * (height / imgHeight))\n\t\t\t\t\t\timgHeight = height\n\t\t\t\t\t}\n\t\t\t\t\tcanvas.width = imgWidth\n\t\t\t\t\tcanvas.height = imgHeight\n\t\t\t\t\tctx.drawImage(this, 0, 0, imgWidth, imgHeight)\n\n\t\t\t\t\t// Draw a border\n\t\t\t\t\tctx.beginPath()\n\t\t\t\t\tctx.fillStyle = 'black'\n\t\t\t\t\tctx.lineWidth = 1\n\t\t\t\t\tctx.moveTo(0, 0)\n\t\t\t\t\tctx.lineTo(imgWidth, 0)\n\t\t\t\t\tctx.lineTo(imgWidth, imgHeight)\n\t\t\t\t\tctx.lineTo(0, imgHeight)\n\t\t\t\t\tctx.lineTo(0, 0)\n\t\t\t\t\tctx.stroke()\n\n\t\t\t\t\t// Create a close badge in the upper-right corner\n\t\t\t\t\tctx.beginPath()\n\t\t\t\t\tctx.arc(imgWidth - 20, 20, 10, 0, 2 * Math.PI)\n\t\t\t\t\tctx.fillStyle = 'white'\n\t\t\t\t\tctx.fill()\n\t\t\t\t\tctx.lineWidth = 2\n\t\t\t\t\tctx.StrokeStyle = 'darkgray'\n\t\t\t\t\tctx.stroke()\n\t\t\t\t\tctx.beginPath()\n\t\t\t\t\tctx.moveTo(imgWidth - (20 + 5), 20 - 5)\n\t\t\t\t\tctx.lineTo(imgWidth - (20 - 5), 20 + 5)\n\t\t\t\t\tctx.stroke()\n\t\t\t\t\tctx.moveTo(imgWidth - (20 - 5), 20 - 5)\n\t\t\t\t\tctx.lineTo(imgWidth - (20 + 5), 20 + 5)\n\t\t\t\t\tctx.stroke()\n\n\t\t\t\t\t// Add filename to generic icon for non image document\n\t\t\t\t\tif (!e.target.result.startsWith('data:image')) {\n\t\t\t\t\t\tctx.fillStyle = 'black'\n\t\t\t\t\t\tctx.font = '12px Arial'\n\t\t\t\t\t\tctx.fillText(file.name, 30, imgHeight - 20)\n\t\t\t\t\t}\n\n\t\t\t\t\t// Save miniature\n\t\t\t\t\tself.miniatures.push({\n\t\t\t\t\t\t'img': canvas.toDataURL(),\n\t\t\t\t\t\t'coords': String(imgWidth - 20) + ',20,10'\n\t\t\t\t\t})\n\n\t\t\t\t}\n\n\t\t\t\t// Save document\n\t\t\t\tself.postAttachments.push(e.target.result)\n\n\t\t\t\t// Draw a generic icon when document is not an image\n\t\t\t\tif (e.target.result.startsWith('data:image')) {\n\t\t\t\t\timg.src = e.target.result\n\t\t\t\t} else {\n\t\t\t\t\timg.src = generateUrl('svg/core/filetypes/x-office-document?color=d8d8d8')\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Start reading selected file\n\t\t\treader.readAsDataURL(file)\n\t\t},\n\t\tremoveAttachment(idx) {\n\t\t\tthis.postAttachments.splice(idx, 1)\n\t\t\tthis.miniatures.splice(idx, 1)\n\t\t},\n\t\tgetImageMapCoords(idx) {\n\t\t\treturn \tthis.miniatures[idx].coords\n\t\t},\n\t\tinsert(emoji) {\n\t\t\tif (typeof emoji === 'object') {\n\t\t\t\tlet category = Object.keys(emoji)[0]\n\t\t\t\tlet emojis = emoji[category]\n\t\t\t\tlet firstEmoji = Object.keys(emojis)[0]\n\t\t\t\temoji = emojis[firstEmoji]\n\t\t\t}\n\t\t\tthis.post += this.$twemoji.parse(emoji) + ' '\n\t\t\tthis.$refs.composerInput.innerHTML += this.$twemoji.parse(emoji) + ' '\n\t\t\tthis.$refs.emojiPicker.hide()\n\t\t},\n\t\ttogglePopoverMenu() {\n\t\t\tthis.menuOpened = !this.menuOpened\n\t\t},\n\t\thidePopoverMenu() {\n\t\t\tthis.menuOpened = false\n\t\t},\n\t\tswitchType(type) {\n\t\t\tthis.type = type\n\t\t\tthis.menuOpened = false\n\t\t\tlocalStorage.setItem('social.lastPostType', type)\n\t\t},\n\t\tgetPostData() {\n\t\t\tlet element = this.$refs.composerInput.cloneNode(true)\n\t\t\tArray.from(element.getElementsByClassName('emoji')).forEach((emoji) => {\n\t\t\t\tvar em = document.createTextNode(emoji.getAttribute('alt'))\n\t\t\t\temoji.replaceWith(em)\n\t\t\t})\n\n\t\t\tlet contentHtml = element.innerHTML\n\n\t\t\t// Extract mentions from content and create an array out of them\n\t\t\tlet to = []\n\t\t\tconst mentionRegex = /<span class=\"mention\"[^>]+><a[^>]+><img[^>]+>@([\\w-_.]+@[\\w-.]+)/g\n\t\t\tlet match = null\n\t\t\tdo {\n\t\t\t\tmatch = mentionRegex.exec(contentHtml)\n\t\t\t\tif (match) {\n\t\t\t\t\tto.push(match[1])\n\t\t\t\t}\n\t\t\t} while (match)\n\n\t\t\t// Add author of original post in case of reply\n\t\t\tif (this.replyTo !== null) {\n\t\t\t\tto.push(this.replyTo.actor_info.account)\n\t\t\t}\n\n\t\t\t// Extract hashtags from content and create an array ot of them\n\t\t\tconst hashtagRegex = />#([^<]+)</g\n\t\t\tlet hashtags = []\n\t\t\tmatch = null\n\t\t\tdo {\n\t\t\t\tmatch = hashtagRegex.exec(contentHtml)\n\t\t\t\tif (match) {\n\t\t\t\t\thashtags.push(match[1])\n\t\t\t\t}\n\t\t\t} while (match)\n\n\t\t\t// Remove all html tags but </div> (wich we turn in newlines) and decode the remaining html entities\n\t\t\tlet content = contentHtml.replace(/<(?!\\/div)[^>]+>/gi, '').replace(/<\\/div>/gi, '\\n').trim()\n\t\t\tcontent = he.decode(content)\n\n\t\t\tlet data = {\n\t\t\t\tcontent: content,\n\t\t\t\tto: to,\n\t\t\t\thashtags: hashtags,\n\t\t\t\ttype: this.type,\n\t\t\t\tattachments: this.postAttachments\n\t\t\t}\n\n\t\t\tif (this.replyTo) {\n\t\t\t\tdata.replyTo = this.replyTo.id\n\t\t\t}\n\n\t\t\treturn data\n\t\t},\n\t\tkeyup(event) {\n\t\t\tif (event.shiftKey || event.ctrlKey) {\n\t\t\t\tthis.createPost(event)\n\t\t\t}\n\t\t},\n\t\tupdatePostFromTribute(event) {\n\t\t\t// Trick to let vue-contenteditable know that tribute replaced a mention or hashtag\n\t\t\tthis.$refs.composerInput.oninput(event)\n\t\t},\n\t\tcreatePost: async function(event) {\n\n\t\t\tlet postData = this.getPostData()\n\n\t\t\t// Trick to validate last mention when the user directly clicks on the \"post\" button without validating it.\n\t\t\tlet regex = /@([-\\w]+)$/\n\t\t\tlet lastMention = postData.content.match(regex)\n\t\t\tif (lastMention) {\n\n\t\t\t\t// Ask the server for matching accounts, and wait for the results\n\t\t\t\tlet result = await this.remoteSearchAccounts(lastMention[1])\n\n\t\t\t\t// Validate the last mention only when it matches a single account\n\t\t\t\tif (result.data.result.accounts.length === 1) {\n\t\t\t\t\tpostData.content = postData.content.replace(regex, '@' + result.data.result.accounts[0].account)\n\t\t\t\t\tpostData.to.push(result.data.result.accounts[0].account)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Abort if the post is a direct message and no valid mentions were found\n\t\t\t// if (this.type === 'direct' && postData.to.length === 0) {\n\t\t\t// \tOC.Notification.showTemporary(t('social', 'Error while trying to post your message: Could not find any valid recipients.'), { type: 'error' })\n\t\t\t// \treturn\n\t\t\t// }\n\n\t\t\t// Post message\n\t\t\tthis.loading = true\n\t\t\tthis.$store.dispatch('post', postData).then((response) => {\n\t\t\t\tthis.loading = false\n\t\t\t\tthis.replyTo = null\n\t\t\t\tthis.post = ''\n\t\t\t\tthis.$refs.composerInput.innerText = this.post\n\t\t\t\tthis.postAttachments = []\n\t\t\t\tthis.miniatures = []\n\t\t\t\tthis.$store.dispatch('refreshTimeline')\n\t\t\t})\n\n\t\t},\n\t\tcloseReply() {\n\t\t\tthis.replyTo = null\n\t\t\t// View may want to hide the composer\n\t\t\tthis.$store.commit('setComposerDisplayStatus', false)\n\t\t},\n\t\tremoteSearchAccounts(text) {\n\t\t\treturn axios.get(generateUrl('apps/social/api/v1/global/accounts/search?search=' + text))\n\t\t},\n\t\tremoteSearchHashtags(text) {\n\t\t\treturn axios.get(generateUrl('apps/social/api/v1/global/tags/search?search=' + text))\n\t\t}\n\t}\n}\n\n<\/script>\n"],sourceRoot:""}]),n.a=r}}]);
//# sourceMappingURL=3.f33023c53c83a5271775.js.map